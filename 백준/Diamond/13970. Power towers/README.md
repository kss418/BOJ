# [Diamond V] Power towers - 13970 

[문제 링크](https://www.acmicpc.net/problem/13970) 

### 성능 요약

메모리: 19044 KB, 시간: 92 ms

### 분류

수학, 정수론, 분할 정복을 이용한 거듭제곱, 소인수분해, 오일러 피 함수

### 제출 일자

2025년 12월 25일 23:32:03

### 문제 설명

<p>Suppose that we have a non empty list of positive integers: [x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>N</sub>]. The power tower corresponding to this list is the number defined as:</p>

<p style="text-align: center;"><mjx-container class="MathJax" jax="CHTML" style="font-size: 109%; position: relative;"> <mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msubsup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.297em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-msubsup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.288em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-script></mjx-msup></mjx-texatom><mjx-spacer style="margin-top: 0.18em;"></mjx-spacer><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msubsup></mjx-texatom><mjx-spacer style="margin-top: 0.18em;"></mjx-spacer><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-script></mjx-msubsup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>x</mi><mn>1</mn><mrow data-mjx-texclass="ORD"><msubsup><mi>x</mi><mn>2</mn><mrow data-mjx-texclass="ORD"><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msub><mi>x</mi><mi>n</mi></msub></mrow></msup></mrow></msup></mrow></msup></mrow></msubsup></mrow></msubsup></math></mjx-assistive-mml><span aria-hidden="true" class="no-mathjax mjx-copytext">$x_1^{x_2^{.^{.^{.^{x_n}}}}}$</span></mjx-container>, that is <mjx-container class="MathJax" jax="CHTML" style="font-size: 109%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msubsup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.297em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c28" style="height: 3.715em; vertical-align: -1.608em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo><mjx-msubsup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.297em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-s3"><mjx-c class="mjx-c28 TEX-S3"></mjx-c></mjx-mo><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-script style="vertical-align: 0.363em;"><mjx-texatom texclass="ORD"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-s3"><mjx-c class="mjx-c29 TEX-S3"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom><mjx-spacer style="margin-top: 0.18em;"></mjx-spacer><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msubsup><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c29" style="height: 3.715em; vertical-align: -1.608em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo></mjx-mrow></mjx-texatom><mjx-spacer style="margin-top: 0.18em;"></mjx-spacer><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-script></mjx-msubsup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>x</mi><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><msubsup><mi>x</mi><mn>2</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msup><mo>.</mo><mrow data-mjx-texclass="ORD"><msub><mi>x</mi><mi>n</mi></msub></mrow></msup></mrow></msup></mrow></msup><mo data-mjx-texclass="CLOSE">)</mo></mrow></mrow></msubsup><mo data-mjx-texclass="CLOSE">)</mo></mrow></mrow></msubsup></math></mjx-assistive-mml><span aria-hidden="true" class="no-mathjax mjx-copytext">$x_1^{\left(x_2^{\left(.^{.^{.^{x_n}}}\right)}\right)}$</span></mjx-container>.</p>

<p>Power towers can be very big numbers, even when the list consists of only a few small integers. For example, the power tower of the list [2, 3, 2] is equal to 2<sup>9</sup> = 512, and that of [5, 2, 3, 2] is equal to 5<sup>512</sup> and has 358 decimal digits. In this task, you will have to compute power towers modulo a given positive integer M.</p>

### 입력 

 <p>The first line of the input will contain two positive integers: T and M. Each of the following T lines will contain a positive integer N, followed by a list of N positive integers x<sub>1</sub>, x<sub>2</sub>, ... x<sub>N</sub>. There will be exactly one space separating consecutive numbers in all lines of the input.</p>

### 출력 

 <p>The output must contain T lines, each containing a single non-negative integer. The number in line k must be equal to the result of the power tower for the k-th given list modulo M.</p>

